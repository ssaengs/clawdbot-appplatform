# =============================================================================
# WORK IN PROGRESS - GHCR container image deployment
# This file is experimental. Use deploy.template.yaml (builds from source) for now.
# =============================================================================
spec:
  name: openclaw
  region: tor
  workers:
    - name: openclaw
      # Deploy from pre-built GHCR image (faster than building from source)
      image:
        registry_type: GHCR
        registry: ghcr.io
        repository: bikramkgupta/openclaw-appplatform
        tag: latest
      instance_count: 1
      instance_size_slug: apps-s-1vcpu-2gb  # Minimum 2GB required - 1GB causes heap overflow
      envs:
        # Provide your Gradient inference key
        - key: GRADIENT_API_KEY
          scope: RUN_TIME
          type: SECRET

        # Required
        - key: SETUP_PASSWORD
          scope: RUN_TIME
          type: SECRET

        # Feature flags
        - key: ENABLE_NGROK
          scope: RUN_TIME
          value: "false"
        - key: ENABLE_TAILSCALE
          scope: RUN_TIME
          value: "false"
        - key: ENABLE_SPACES
          scope: RUN_TIME
          value: "false"
        - key: ENABLE_UI
          scope: RUN_TIME
          value: "false"

        # ngrok config
        - key: NGROK_AUTHTOKEN
          scope: RUN_TIME
          type: SECRET

        # Tailscale config
        - key: TS_AUTHKEY
          scope: RUN_TIME
          type: SECRET
        - key: TS_HOSTNAME
          scope: RUN_TIME
          value: openclaw
        - key: TS_USERSPACE
          scope: RUN_TIME
          value: "true"
        - key: TS_SOCKET
          scope: RUN_TIME
          value: /tmp/tailscaled.sock

        # Spaces config
        - key: LITESTREAM_ACCESS_KEY_ID
          scope: RUN_TIME
          type: SECRET
        - key: LITESTREAM_SECRET_ACCESS_KEY
          scope: RUN_TIME
          type: SECRET
        - key: SPACES_ENDPOINT
          scope: RUN_TIME
          value: tor1.digitaloceanspaces.com
        - key: SPACES_BUCKET
          scope: RUN_TIME
          value: openclaw-backup
        - key: RESTIC_PASSWORD
          scope: RUN_TIME
          type: SECRET

        # Optional
        - key: OPENCLAW_GATEWAY_TOKEN
          scope: RUN_TIME
          type: SECRET
        - key: SSH_ENABLE
          scope: RUN_TIME
          value: "false"
        - key: GITHUB_USERNAME
          scope: RUN_TIME
          value: ""
